<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Government Watchdog - Transparency & Accountability Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5em;
            font-weight: 600;
        }
        
        .logo .emoji {
            font-size: 2em;
            margin-right: 10px;
        }
        
        .user-area {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .auth-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .auth-input {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .auth-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-secondary {
            background: #2196F3;
            color: white;
        }
        
        .btn-danger {
            background: #f44336;
            color: white;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0;
            margin-top: 20px;
        }
        
        .nav-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
        }
        
        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: translateY(2px);
        }
        
        .main-content {
            padding: 40px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #e6f2ff 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #2196F3;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #1565C0;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-weight: 500;
        }
        
        .search-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-label {
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }
        
        .form-input, .form-select {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2196F3;
        }
        
        .search-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s;
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
        }
        
        .results-section {
            margin-top: 30px;
        }
        
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .results-count {
            font-size: 1.2em;
            color: #1565C0;
            font-weight: 600;
        }
        
        .member-card, .bill-card, .spending-card, .lobbying-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #2196F3;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }
        
        .lobbying-card {
            border-left-color: #FF9800;
        }
        
        .member-card:hover, .bill-card:hover, .spending-card:hover, .lobbying-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .member-name, .bill-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #1565C0;
            margin-bottom: 10px;
        }
        
        .lobbying-amount {
            font-size: 1.1em;
            font-weight: 600;
            color: #FF9800;
            background: rgba(255, 152, 0, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .result-details .detail-row {
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .result-details strong {
            color: #1565C0;
        }
        
        .member-info, .bill-info {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #666;
        }
        
        .party-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .party-d { background: #e3f2fd; color: #1565c0; }
        .party-r { background: #ffebee; color: #c62828; }
        .party-i { background: #f3e5f5; color: #7b1fa2; }
        
        .amount {
            font-weight: 600;
            color: #2e7d32;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1em;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #c62828;
        }
        
        .success {
            background: #e8f5e8;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #2e7d32;
        }
        
        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }
            
            .header-top {
                flex-direction: column;
                gap: 15px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .search-form {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .nav-tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-top">
                <div class="logo">
                    <span class="emoji">üèõÔ∏è</span>
                    Government Watchdog
                </div>
                <div class="user-area">
                    <div id="authSection" class="auth-form">
                        <input type="text" id="username" class="auth-input" placeholder="Username">
                        <input type="password" id="password" class="auth-input" placeholder="Password">
                        <button onclick="login()" class="auth-btn btn-primary">Login</button>
                        <button onclick="register()" class="auth-btn btn-secondary">Register</button>
                    </div>
                    <div id="userInfo" class="user-info" style="display:none;"></div>
                    <button onclick="logout()" class="auth-btn btn-danger" id="logoutBtn" style="display:none;">Logout</button>
                </div>
            </div>
            
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="dashboard">üìä Dashboard</button>
                <button class="nav-tab" data-tab="congress">üèõÔ∏è Congress</button>
                <button class="nav-tab" data-tab="legislation">üìã Legislation</button>
                <button class="nav-tab" data-tab="spending">üí∞ Spending</button>
                <button class="nav-tab" data-tab="lobbying">ü§ù Lobbying</button>
            </nav>
        </header>
        
        <main class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <h2>Government Transparency Dashboard</h2>
                <div class="dashboard-grid" id="dashboardStats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalMembers">-</div>
                        <div class="stat-label">Congressional Members</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeBills">-</div>
                        <div class="stat-label">Active Bills</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalSpending">-</div>
                        <div class="stat-label">Federal Spending (2024)</div>
                    </div>
                </div>
                
                <div class="search-section">
                    <h3 style="margin-bottom: 20px;">üöÄ Platform Features</h3>
                    <p style="margin-bottom: 15px;">This government watchdog platform provides real-time access to:</p>
                    <ul style="margin-left: 20px; line-height: 1.6;">
                        <li><strong>Congressional Data:</strong> Track members, voting records, and legislative activity</li>
                        <li><strong>Federal Spending:</strong> Monitor government contracts and expenditures</li>
                        <li><strong>Legislation Tracking:</strong> Follow bills through the legislative process</li>
                        <li><strong>Lobbying Activities:</strong> View lobbying registrations and expenditures</li>
                        <li><strong>Campaign Finance:</strong> Track political contributions and spending</li>
                    </ul>
                </div>
            </div>
            
            <!-- Congress Tab -->
            <div id="congress" class="tab-content">
                <h2>Congressional Members</h2>
                <div class="search-section">
                    <div class="filters-row">
                        <div class="form-group">
                            <label class="form-label">State</label>
                            <select id="congressState" class="form-select">
                                <option value="">All States</option>
                                <option value="AL">Alabama</option>
                                <option value="AK">Alaska</option>
                                <option value="AZ">Arizona</option>
                                <option value="AR">Arkansas</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="IA">Iowa</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="ME">Maine</option>
                                <option value="MD">Maryland</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MS">Mississippi</option>
                                <option value="MO">Missouri</option>
                                <option value="MT">Montana</option>
                                <option value="NE">Nebraska</option>
                                <option value="NV">Nevada</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NY">New York</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VT">Vermont</option>
                                <option value="VA">Virginia</option>
                                <option value="WA">Washington</option>
                                <option value="WV">West Virginia</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WY">Wyoming</option>
                                <option value="DC">District of Columbia</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Party</label>
                            <select id="congressParty" class="form-select">
                                <option value="">All Parties</option>
                                <option value="D">Democrat</option>
                                <option value="R">Republican</option>
                                <option value="I">Independent</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chamber</label>
                            <select id="congressChamber" class="form-select">
                                <option value="">All Branches & Levels</option>
                                <option value="house">House of Representatives</option>
                                <option value="senate">Senate</option>
                                <option value="executive">Executive Branch</option>
                                <option value="judicial">Supreme Court</option>
                                <option value="independent">Independent Agencies</option>
                                <option value="state">State Governors</option>
                            </select>
                        </div>
                        <button onclick="searchCongress()" class="search-btn">Search Members</button>
                    </div>
                </div>
                <div id="congressResults" class="results-section"></div>
            </div>
            
            <!-- Legislation Tab -->
            <div id="legislation" class="tab-content">
                <h2>Bills & Legislation</h2>
                <div class="search-section">
                    <div class="filters-row">
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="billStatus" class="form-select">
                                <option value="">All Status</option>
                                <option value="introduced">Introduced</option>
                                <option value="in_committee">In Committee</option>
                                <option value="passed_house">Passed House</option>
                                <option value="passed_senate">Passed Senate</option>
                                <option value="enacted">Enacted</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subject</label>
                            <input type="text" id="billSubject" class="form-input" placeholder="e.g., healthcare, infrastructure">
                        </div>
                        <button onclick="searchLegislation()" class="search-btn">Search Bills</button>
                    </div>
                </div>
                <div id="legislationResults" class="results-section"></div>
            </div>
            
            <!-- Spending Tab -->
            <div id="spending" class="tab-content">
                <h2>Federal Spending & Contracts</h2>
                <div class="search-section">
                    <div class="filters-row">
                        <div class="form-group">
                            <label class="form-label">Agency</label>
                            <input type="text" id="spendingAgency" class="form-input" placeholder="e.g., Defense, Education">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Recipient</label>
                            <input type="text" id="spendingRecipient" class="form-input" placeholder="e.g., Boeing, University">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Min Amount</label>
                            <input type="number" id="spendingAmount" class="form-input" placeholder="1000000">
                        </div>
                        <button onclick="searchSpending()" class="search-btn">Search Spending</button>
                    </div>
                </div>
                <div id="spendingResults" class="results-section"></div>
            </div>
            
            <!-- Lobbying Tab -->
            <div id="lobbying" class="tab-content">
                <h2>Lobbying Activities</h2>
                <div class="search-section">
                    <div class="filters-row">
                        <div class="form-group">
                            <label class="form-label">Client</label>
                            <input type="text" id="lobbyingClient" class="form-input" placeholder="Company or organization">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Lobbyist</label>
                            <input type="text" id="lobbyingLobbyist" class="form-input" placeholder="Lobbyist name or firm">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Year</label>
                            <select id="lobbyingYear" class="form-select">
                                <option value="">All Years</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                            </select>
                        </div>
                        <button onclick="searchLobbying()" class="search-btn">Search Lobbying</button>
                    </div>
                </div>
                <div id="lobbyingResults" class="results-section"></div>
            </div>
        </main>
    </div>

    <script>
        let token = localStorage.getItem('govWatchdogToken');
        let currentUser = null;

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('JavaScript Error:', e.error);
        });

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Government Watchdog App initializing...');
            try {
                if (token) {
                    fetchUserInfo();
                }
                loadDashboard();

                // Attach click listeners to nav tabs using data-tab attributes
                try {
                    document.querySelectorAll('.nav-tab').forEach(btn => {
                        const tabName = btn.dataset.tab;
                        if (!tabName) return;
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            switchTab(tabName, btn);
                        });
                    });
                } catch (err) {
                    console.warn('Failed to attach nav-tab listeners:', err);
                }

                console.log('App initialization complete');
            } catch (error) {
                console.error('Initialization error:', error);
            }
        });

        // Authentication functions
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('Please enter both username and password', 'error');
                return;
            }

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                if (response.ok) {
                    token = data.token;
                    currentUser = data.user;
                    localStorage.setItem('govWatchdogToken', token);
                    updateAuthUI();
                    clearAuthInputs();
                    showMessage(`Welcome back, ${currentUser.username}!`, 'success');
                } else {
                    showMessage(data.error || 'Login failed', 'error');
                }
            } catch (error) {
                showMessage('Network error during login', 'error');
            }
        }

        async function register() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showMessage('Please enter both username and password', 'error');
                return;
            }

            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        username, 
                        password, 
                        email: username + '@watchdog.gov' // Demo email
                    })
                });

                const data = await response.json();
                if (response.ok) {
                    token = data.token;
                    currentUser = data.user;
                    localStorage.setItem('govWatchdogToken', token);
                    updateAuthUI();
                    clearAuthInputs();
                    showMessage(`Account created! Welcome, ${currentUser.username}!`, 'success');
                } else {
                    showMessage(data.error || 'Registration failed', 'error');
                }
            } catch (error) {
                showMessage('Network error during registration', 'error');
            }
        }

        function logout() {
            token = null;
            currentUser = null;
            localStorage.removeItem('govWatchdogToken');
            updateAuthUI();
            showMessage('Logged out successfully', 'success');
        }

        function updateAuthUI() {
            const authSection = document.getElementById('authSection');
            const userInfo = document.getElementById('userInfo');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (currentUser) {
                authSection.style.display = 'none';
                userInfo.style.display = 'block';
                userInfo.textContent = `Logged in as ${currentUser.username}`;
                logoutBtn.style.display = 'block';
            } else {
                authSection.style.display = 'flex';
                userInfo.style.display = 'none';
                logoutBtn.style.display = 'none';
            }
        }

        function clearAuthInputs() {
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // Tab switching
        function switchTab(tabName, buttonElement) {
            console.log('Switching to tab:', tabName);
            try {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab
                const selectedTab = document.getElementById(tabName);
                if (selectedTab) {
                    selectedTab.classList.add('active');
                    console.log('Activated tab:', tabName);
                } else {
                    console.error('Tab not found:', tabName);
                }
                
                // Add active class to clicked tab button
                if (buttonElement) {
                    buttonElement.classList.add('active');
                } else {
                    // Fallback: find the tab button by onclick attribute
                    document.querySelectorAll('.nav-tab').forEach(tab => {
                        const onclickAttr = tab.getAttribute('onclick');
                        if (onclickAttr && onclickAttr.includes(tabName)) {
                            tab.classList.add('active');
                        }
                    });
                }
                
                // Load data for specific tabs
                if (tabName === 'dashboard') {
                    loadDashboard();
                }
            } catch (error) {
                console.error('Error switching tabs:', error);
            }
        }

        // Dashboard functions
        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard/summary');
                const data = await response.json();
                
                document.getElementById('totalMembers').textContent = data.totalMembers?.count || '4';
                document.getElementById('activeBills').textContent = data.activeBills?.count || '3';
                document.getElementById('totalSpending').textContent = 
                    data.totalSpending?.total ? `$${(data.totalSpending.total / 1e9).toFixed(1)}B` : '$23.6B';
            } catch (error) {
                console.error('Failed to load dashboard:', error);
                // Show sample data even if API fails
                document.getElementById('totalMembers').textContent = '4';
                document.getElementById('activeBills').textContent = '3';
                document.getElementById('totalSpending').textContent = '$23.6B';
            }
        }

        // Congress search
        async function searchCongress() {
            const state = document.getElementById('congressState').value;
            const party = document.getElementById('congressParty').value;
            const chamber = document.getElementById('congressChamber').value;
            
            showLoading('congressResults');
            
            try {
                const params = new URLSearchParams();
                if (state) params.append('state', state);
                if (party) params.append('party', party);
                if (chamber) params.append('chamber', chamber);
                
                const response = await fetch(`/api/congress/members?${params}`);
                const members = await response.json();
                
                displayCongressResults(members);
            } catch (error) {
                showMessage('Failed to search congressional members', 'error');
            }
        }

        function displayCongressResults(members) {
            const container = document.getElementById('congressResults');
            
            if (members.length === 0) {
                container.innerHTML = '<div class="results-header"><div class="results-count">No members found</div></div>';
                return;
            }
            
            let html = `<div class="results-header"><div class="results-count">Found ${members.length} members</div></div>`;
            
            members.forEach(member => {
                let chamberDisplay = '';
                if (member.chamber === 'house') chamberDisplay = 'House';
                else if (member.chamber === 'senate') chamberDisplay = 'Senate';
                else if (member.chamber === 'executive') chamberDisplay = 'Executive Branch';
                else if (member.chamber === 'judicial') chamberDisplay = 'Supreme Court';
                else if (member.chamber === 'independent') chamberDisplay = 'Independent Agency';
                else if (member.chamber === 'state') chamberDisplay = 'State Government';
                else chamberDisplay = member.chamber;
                
                html += `
                    <div class="member-card">
                        <div class="member-name">${member.first_name} ${member.last_name}</div>
                        <div class="member-info">
                            <span class="party-badge party-${member.party.toLowerCase()}">${member.party}</span>
                            <span>${member.state}</span>
                            <span>${chamberDisplay}</span>
                            ${member.district ? `<span>District ${member.district}</span>` : ''}
                            ${member.phone ? `<span>üìû ${member.phone}</span>` : ''}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Legislation search
        async function searchLegislation() {
            const status = document.getElementById('billStatus').value;
            const subject = document.getElementById('billSubject').value;
            
            showLoading('legislationResults');
            
            try {
                const params = new URLSearchParams();
                if (status) params.append('status', status);
                if (subject) params.append('subject', subject);
                
                const response = await fetch(`/api/legislation/bills?${params}`);
                const bills = await response.json();
                
                displayLegislationResults(bills);
            } catch (error) {
                showMessage('Failed to search legislation', 'error');
            }
        }

        function displayLegislationResults(bills) {
            const container = document.getElementById('legislationResults');
            
            if (bills.length === 0) {
                container.innerHTML = '<div class="results-header"><div class="results-count">No bills found</div></div>';
                return;
            }
            
            let html = `<div class="results-header"><div class="results-count">Found ${bills.length} bills</div></div>`;
            
            bills.forEach(bill => {
                html += `
                    <div class="bill-card">
                        <div class="bill-title">${bill.title}</div>
                        <div class="bill-info">
                            <span><strong>${bill.bill_type.toUpperCase()} ${bill.number}</strong></span>
                            <span>Status: ${bill.status.replace(/_/g, ' ')}</span>
                            <span>Introduced: ${new Date(bill.introduced_date).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Spending search
        async function searchSpending() {
            const agency = document.getElementById('spendingAgency').value;
            const recipient = document.getElementById('spendingRecipient').value;
            const minAmount = document.getElementById('spendingAmount').value;
            
            showLoading('spendingResults');
            
            try {
                const params = new URLSearchParams();
                if (agency) params.append('agency', agency);
                if (recipient) params.append('recipient', recipient);
                if (minAmount) params.append('min_amount', minAmount);
                
                const response = await fetch(`/api/spending?${params}`);
                const spending = await response.json();
                
                displaySpendingResults(spending);
            } catch (error) {
                showMessage('Failed to search spending data', 'error');
            }
        }

        function displaySpendingResults(spending) {
            const container = document.getElementById('spendingResults');
            
            if (spending.length === 0) {
                container.innerHTML = '<div class="results-header"><div class="results-count">No spending records found</div></div>';
                return;
            }
            
            let html = `<div class="results-header"><div class="results-count">Found ${spending.length} spending records</div></div>`;
            
            spending.forEach(award => {
                html += `
                    <div class="spending-card">
                        <div class="member-name">${award.recipient_name}</div>
                        <div class="member-info">
                            <span class="amount">$${(award.award_amount / 1e6).toFixed(1)}M</span>
                            <span>${award.awarding_agency}</span>
                            <span>${award.award_type}</span>
                            <span>FY ${award.fiscal_year}</span>
                        </div>
                        <div style="margin-top: 10px; color: #666; font-size: 0.9em;">${award.award_description}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Lobbying search
        async function searchLobbying() {
            showLoading('lobbyingResults');
            
            try {
                const response = await fetch('/api/lobbying');
                const lobbying = await response.json();
                
                displayLobbyingResults(lobbying);
            } catch (error) {
                showMessage('Failed to search lobbying data', 'error');
            }
        }

        function displayLobbyingResults(lobbying) {
            const container = document.getElementById('lobbyingResults');
            if (!lobbying || lobbying.length === 0) {
                container.innerHTML = '<div class="results-header"><div class="results-count">No lobbying data found</div></div>';
                return;
            }
            
            let html = `<div class="results-header">
                <div class="results-count">${lobbying.length} lobbying record${lobbying.length !== 1 ? 's' : ''} found</div>
            </div>`;
            
            html += '<div class="results-container">';
            lobbying.forEach(record => {
                const amount = record.amount ? `$${(record.amount / 1000000).toFixed(1)}M` : 'Amount not disclosed';
                html += `
                    <div class="result-card lobbying-card">
                        <div class="result-header">
                            <h3>${record.client_name}</h3>
                            <div class="lobbying-amount">${amount}</div>
                        </div>
                        <div class="result-details">
                            <div class="detail-row">
                                <strong>Registrant:</strong> ${record.registrant_name}
                            </div>
                            ${record.client_description ? `
                            <div class="detail-row">
                                <strong>Client Description:</strong> ${record.client_description}
                            </div>` : ''}
                            <div class="detail-row">
                                <strong>Report Year:</strong> ${record.report_year}
                            </div>
                            <div class="detail-row">
                                <strong>Report Type:</strong> ${record.report_type}
                            </div>
                            ${record.government_entities ? `
                            <div class="detail-row">
                                <strong>Government Entities:</strong> ${record.government_entities}
                            </div>` : ''}
                            ${record.issues ? `
                            <div class="detail-row">
                                <strong>Issues:</strong> ${record.issues}
                            </div>` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        // Utility functions
        function showLoading(containerId) {
            document.getElementById(containerId).innerHTML = '<div class="loading">üîÑ Loading data...</div>';
        }

        function showMessage(message, type = 'success') {
            // Create a temporary message element
            const msgEl = document.createElement('div');
            msgEl.className = type;
            msgEl.textContent = message;
            msgEl.style.position = 'fixed';
            msgEl.style.top = '20px';
            msgEl.style.right = '20px';
            msgEl.style.zIndex = '1000';
            msgEl.style.padding = '15px 20px';
            msgEl.style.borderRadius = '8px';
            msgEl.style.maxWidth = '400px';
            
            document.body.appendChild(msgEl);
            
            setTimeout(() => {
                document.body.removeChild(msgEl);
            }, 5000);
        }
        
        // Auto-load data on startup
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                searchCongress();
                searchLegislation();
                searchSpending();
            }, 1500);
        });
    </script>
</body>
</html>