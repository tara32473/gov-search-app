<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Government Watchdog - Track Government Accountability</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            text-align: center;
            padding: 3rem 1rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .search-section {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .search-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .search-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .search-card h3 {
            color: #1e3c72;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .search-btn {
            background: #007cba;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            transition: background 0.3s;
        }

        .search-btn:hover {
            background: #005a87;
        }

        .results {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }

        .result-item {
            background: white;
            border-left: 4px solid #007cba;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 5px 5px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .result-title {
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 0.5rem;
        }

        .result-detail {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .loading {
            text-align: center;
            color: #007cba;
            font-style: italic;
        }

        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 1rem;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }

        .icon {
            font-size: 1.5rem;
        }

        .footer {
            background: #1e3c72;
            color: white;
            text-align: center;
            padding: 2rem;
            margin-top: 3rem;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .container { padding: 1rem; }
            .search-section { padding: 1rem; }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>üèõÔ∏è Government Watchdog</h1>
        <p>Track government accountability and transparency in real-time</p>
    </header>

    <div class="container">
        <div class="search-section">
            <h2>Search Government Data</h2>
            <p>Explore Congress members, federal spending, lobbying activities, and legislation. Enter keywords to find specific information.</p>
            
            <div class="search-grid">
                <div class="search-card">
                    <h3><span class="icon">üë•</span> Congress Members</h3>
                    <p>Search for representatives and senators</p>
                    <input type="text" class="search-input" id="congress-search" placeholder="Enter name, state (e.g., CA, TX), or party...">
                    <button class="search-btn" onclick="searchCongress()">Search Congress</button>
                    <div id="congress-results" class="results"></div>
                </div>

                <div class="search-card">
                    <h3><span class="icon">üí∞</span> Federal Spending</h3>
                    <p>Track government expenditures and contracts</p>
                    <input type="text" class="search-input" id="spending-search" placeholder="Enter agency, recipient, or keyword...">
                    <button class="search-btn" onclick="searchSpending()">Search Spending</button>
                    <div id="spending-results" class="results"></div>
                </div>

                <div class="search-card">
                    <h3><span class="icon">ü§ù</span> Lobbying Activity</h3>
                    <p>Monitor lobbying efforts and influence</p>
                    <input type="text" class="search-input" id="lobbying-search" placeholder="Enter client, lobbyist, or issue (e.g., healthcare)...">
                    <button class="search-btn" onclick="searchLobbying()">Search Lobbying</button>
                    <div id="lobbying-results" class="results"></div>
                </div>

                <div class="search-card">
                    <h3><span class="icon">üìã</span> Legislation</h3>
                    <p>Follow bills, track voting records, and monitor legislative progress</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                        <input type="text" class="search-input" id="legislation-search" placeholder="Enter bill title, sponsor, or topic..." style="margin-bottom: 0;">
                        
                        <select class="search-input" id="legislation-filter" style="margin-bottom: 0;">
                            <option value="">All Bills</option>
                            <option value="hr">House Bills (HR)</option>
                            <option value="s">Senate Bills (S)</option>
                            <option value="introduced">Introduced</option>
                            <option value="passed">Passed</option>
                            <option value="enacted">Enacted</option>
                        </select>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; margin-bottom: 1rem;">
                        <select class="search-input" id="congress-filter" style="margin-bottom: 0;">
                            <option value="">All Congresses</option>
                            <option value="119">119th Congress (2025-2027)</option>
                            <option value="118">118th Congress (2023-2025)</option>
                            <option value="117">117th Congress (2021-2023)</option>
                        </select>
                        
                        <button class="search-btn" onclick="searchLegislation()" style="width: auto; padding: 0.75rem 1rem;">Search Bills</button>
                    </div>
                    
                    <div id="legislation-results" class="results"></div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Government Watchdog | Promoting transparency and accountability</p>
        <p>Data sourced from official government APIs and public records</p>
    </footer>

    <script>
        const API_BASE = 'https://gov-search-app-production.up.railway.app';

        async function searchAPI(endpoint, resultsId, keyword = '') {
            const resultsDiv = document.getElementById(resultsId);
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">üîç Searching...</div>';

            try {
                // Get all data first (since API doesn't support keyword filtering yet)
                const response = await fetch(`${API_BASE}${endpoint}?limit=50`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                let results = data.data || data;
                if (!Array.isArray(results)) {
                    results = [results];
                }

                // Client-side filtering if keyword is provided
                if (keyword) {
                    const searchTerm = keyword.toLowerCase().trim();
                    
                    // State abbreviation mapping for Congress searches
                    const stateMap = {
                        'al': 'alabama', 'ak': 'alaska', 'az': 'arizona', 'ar': 'arkansas', 'ca': 'california',
                        'co': 'colorado', 'ct': 'connecticut', 'de': 'delaware', 'fl': 'florida', 'ga': 'georgia',
                        'hi': 'hawaii', 'id': 'idaho', 'il': 'illinois', 'in': 'indiana', 'ia': 'iowa',
                        'ks': 'kansas', 'ky': 'kentucky', 'la': 'louisiana', 'me': 'maine', 'md': 'maryland',
                        'ma': 'massachusetts', 'mi': 'michigan', 'mn': 'minnesota', 'ms': 'mississippi', 'mo': 'missouri',
                        'mt': 'montana', 'ne': 'nebraska', 'nv': 'nevada', 'nh': 'new hampshire', 'nj': 'new jersey',
                        'nm': 'new mexico', 'ny': 'new york', 'nc': 'north carolina', 'nd': 'north dakota', 'oh': 'ohio',
                        'ok': 'oklahoma', 'or': 'oregon', 'pa': 'pennsylvania', 'ri': 'rhode island', 'sc': 'south carolina',
                        'sd': 'south dakota', 'tn': 'tennessee', 'tx': 'texas', 'ut': 'utah', 'vt': 'vermont',
                        'va': 'virginia', 'wa': 'washington', 'wv': 'west virginia', 'wi': 'wisconsin', 'wy': 'wyoming'
                    };

                    // Expand state abbreviation if found
                    const expandedTerm = stateMap[searchTerm] || searchTerm;

                    results = results.filter(item => {
                        const searchableText = JSON.stringify(item).toLowerCase();
                        return searchableText.includes(searchTerm) || 
                               searchableText.includes(expandedTerm) ||
                               (item.state && item.state.toLowerCase() === searchTerm) ||
                               (item.first_name && item.first_name.toLowerCase().includes(searchTerm)) ||
                               (item.last_name && item.last_name.toLowerCase().includes(searchTerm)) ||
                               (item.party && item.party.toLowerCase().includes(searchTerm)) ||
                               (item.client_name && item.client_name.toLowerCase().includes(searchTerm)) ||
                               (item.agency && item.agency.toLowerCase().includes(searchTerm)) ||
                               (item.recipient && item.recipient.toLowerCase().includes(searchTerm));
                    });
                }

                if (results.length === 0) {
                    resultsDiv.innerHTML = '<div class="result-item">No results found. Try a different search term or browse all results by leaving the search blank.</div>';
                    return;
                }

                resultsDiv.innerHTML = results.slice(0, 10).map(item => formatResult(item, resultsId)).join('');
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        function formatResult(item, type) {
            switch(type.split('-')[0]) {
                case 'congress':
                    return `
                        <div class="result-item">
                            <div class="result-title">${item.name || 'Unknown'}</div>
                            <div class="result-detail">Party: ${item.party || 'N/A'}</div>
                            <div class="result-detail">State: ${item.state || 'N/A'}</div>
                            <div class="result-detail">Chamber: ${item.chamber || 'N/A'}</div>
                        </div>
                    `;
                case 'spending':
                    return `
                        <div class="result-item">
                            <div class="result-title">${item.recipient || item.description || 'Federal Spending'}</div>
                            <div class="result-detail">Amount: $${item.amount ? item.amount.toLocaleString() : 'N/A'}</div>
                            <div class="result-detail">Agency: ${item.agency || 'N/A'}</div>
                            <div class="result-detail">Date: ${item.date || 'N/A'}</div>
                        </div>
                    `;
                case 'lobbying':
                    return `
                        <div class="result-item">
                            <div class="result-title">${item.client || 'Lobbying Activity'}</div>
                            <div class="result-detail">Lobbyist: ${item.lobbyist || 'N/A'}</div>
                            <div class="result-detail">Issue: ${item.issue || 'N/A'}</div>
                            <div class="result-detail">Amount: $${item.amount ? item.amount.toLocaleString() : 'N/A'}</div>
                        </div>
                    `;
                case 'legislation':
                    const billType = item.bill_type?.toUpperCase() || 'BILL';
                    const billNumber = item.number || 'Unknown';
                    const congress = item.congress || 'N/A';
                    const status = item.status || 'unknown';
                    
                    // Status badge colors
                    const statusColors = {
                        'introduced': '#6c757d',
                        'passed': '#28a745', 
                        'enacted': '#007bff',
                        'failed': '#dc3545',
                        'withdrawn': '#ffc107'
                    };
                    const statusColor = statusColors[status.toLowerCase()] || '#6c757d';
                    
                    // Bill type explanations
                    const billTypes = {
                        'HR': 'House Bill',
                        'S': 'Senate Bill', 
                        'HJRES': 'House Joint Resolution',
                        'SJRES': 'Senate Joint Resolution',
                        'HCONRES': 'House Concurrent Resolution',
                        'SCONRES': 'Senate Concurrent Resolution',
                        'HRES': 'House Resolution',
                        'SRES': 'Senate Resolution'
                    };
                    const billTypeLabel = billTypes[billType] || 'Bill';
                    
                    return `
                        <div class="result-item">
                            <div class="result-title" style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <span style="background: ${statusColor}; color: white; padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.8rem; text-transform: uppercase;">${status}</span>
                                <strong>${billType} ${billNumber}</strong>
                                <span style="color: #666; font-size: 0.9rem;">(${congress}th Congress)</span>
                            </div>
                            <div style="font-weight: 500; margin-bottom: 0.5rem;">${item.title || 'Bill Title Not Available'}</div>
                            <div class="result-detail"><strong>Type:</strong> ${billTypeLabel}</div>
                            <div class="result-detail"><strong>Introduced:</strong> ${item.introduced_date ? new Date(item.introduced_date).toLocaleDateString() : 'N/A'}</div>
                            ${item.latest_action ? `<div class="result-detail"><strong>Latest Action:</strong> ${item.latest_action} ${item.latest_action_date ? '(' + new Date(item.latest_action_date).toLocaleDateString() + ')' : ''}</div>` : ''}
                            ${item.summary ? `<div class="result-detail" style="margin-top: 0.5rem; font-style: italic;">${item.summary}</div>` : ''}
                        </div>
                    `;
                default:
                    return `
                        <div class="result-item">
                            <div class="result-title">Government Record</div>
                            <pre>${JSON.stringify(item, null, 2)}</pre>
                        </div>
                    `;
            }
        }

        function searchCongress() {
            const keyword = document.getElementById('congress-search').value;
            searchAPI('/api/congress/members', 'congress-results', keyword);
        }

        function searchSpending() {
            const keyword = document.getElementById('spending-search').value;
            searchAPI('/api/spending', 'spending-results', keyword);
        }

        function searchLobbying() {
            const keyword = document.getElementById('lobbying-search').value;
            searchAPI('/api/lobbying', 'lobbying-results', keyword);
        }

        function searchLegislation() {
            const keyword = document.getElementById('legislation-search').value;
            const billTypeFilter = document.getElementById('legislation-filter').value;
            const congressFilter = document.getElementById('congress-filter').value;
            
            // Enhanced search with filters
            searchLegislationWithFilters(keyword, billTypeFilter, congressFilter);
        }

        async function searchLegislationWithFilters(keyword = '', billTypeFilter = '', congressFilter = '') {
            const resultsDiv = document.getElementById('legislation-results');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading">üîç Searching legislation...</div>';

            try {
                // Build endpoint with filters
                let endpoint = `${API_BASE}/api/legislation/bills?limit=100`;
                
                if (congressFilter) {
                    endpoint += `&congress=${congressFilter}`;
                }
                
                const response = await fetch(endpoint);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                let results = data.data || data;
                if (!Array.isArray(results)) {
                    results = [results];
                }

                // Client-side filtering for bill type and status
                if (billTypeFilter) {
                    if (billTypeFilter === 'hr' || billTypeFilter === 's') {
                        results = results.filter(item => item.bill_type && item.bill_type.toLowerCase() === billTypeFilter);
                    } else if (['introduced', 'passed', 'enacted'].includes(billTypeFilter)) {
                        results = results.filter(item => item.status && item.status.toLowerCase() === billTypeFilter);
                    }
                }

                // Text search filtering
                if (keyword) {
                    const searchTerm = keyword.toLowerCase().trim();
                    results = results.filter(item => {
                        const searchableText = JSON.stringify(item).toLowerCase();
                        return searchableText.includes(searchTerm) ||
                               (item.title && item.title.toLowerCase().includes(searchTerm)) ||
                               (item.summary && item.summary.toLowerCase().includes(searchTerm)) ||
                               (item.sponsor && item.sponsor.toLowerCase().includes(searchTerm)) ||
                               (item.bill_id && item.bill_id.toLowerCase().includes(searchTerm));
                    });
                }

                if (results.length === 0) {
                    resultsDiv.innerHTML = '<div class="result-item">No bills found matching your criteria. Try adjusting your filters or search terms.</div>';
                    return;
                }

                resultsDiv.innerHTML = `
                    <div style="margin-bottom: 1rem; padding: 0.5rem; background: #f8f9fa; border-radius: 4px; font-size: 0.9rem;">
                        Found ${results.length} bill${results.length !== 1 ? 's' : ''} matching your criteria
                    </div>
                    ${results.slice(0, 20).map(item => formatResult(item, 'legislation-results')).join('')}
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Allow Enter key to trigger search
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'congress-search') searchCongress();
                else if (activeElement.id === 'spending-search') searchSpending();
                else if (activeElement.id === 'lobbying-search') searchLobbying();
                else if (activeElement.id === 'legislation-search') searchLegislation();
            }
        });

        // Auto-trigger search when filters change
        document.addEventListener('DOMContentLoaded', function() {
            const legislationFilter = document.getElementById('legislation-filter');
            const congressFilter = document.getElementById('congress-filter');
            
            if (legislationFilter) {
                legislationFilter.addEventListener('change', function() {
                    const keyword = document.getElementById('legislation-search').value;
                    if (keyword || this.value || document.getElementById('congress-filter').value) {
                        searchLegislation();
                    }
                });
            }
            
            if (congressFilter) {
                congressFilter.addEventListener('change', function() {
                    const keyword = document.getElementById('legislation-search').value;
                    if (keyword || this.value || document.getElementById('legislation-filter').value) {
                        searchLegislation();
                    }
                });
            }
        });
    </script>
</body>
</html>